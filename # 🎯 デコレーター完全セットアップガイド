# ğŸ¯ ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼å®Œå…¨ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰

## ğŸ“ ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆ

ä»¥ä¸‹ã®ã‚ˆã†ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ï¼š

```
C:\Users\yukik\Desktop\excel\
â”œâ”€â”€ decorators.py  â† ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«
â””â”€â”€ main.py        â† ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’ä½¿ã†ãƒ•ã‚¡ã‚¤ãƒ«
```

---

## ğŸ“ ã‚¹ãƒ†ãƒƒãƒ—2: decorators.py ã‚’ä½œæˆ

**æ‰‹é †**:
1. ãƒ¡ãƒ¢å¸³ã¾ãŸã¯VSCodeã‚’é–‹ã
2. ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼
3. `decorators.py` ã¨ã—ã¦ä¿å­˜

```python
"""decorators.py - ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«"""

import functools
import time
import logging

# ãƒ­ã‚¬ãƒ¼ã®è¨­å®š
logger = logging.getLogger(__name__)
logger.setLevel(logging.INFO)

console_handler = logging.StreamHandler()
console_handler.setLevel(logging.INFO)

formatter = logging.Formatter(
    '[%(asctime)s] %(levelname)-8s %(message)s',
    datefmt='%H:%M:%S'
)
console_handler.setFormatter(formatter)

if not logger.handlers:
    logger.addHandler(console_handler)


# ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼1: é–¢æ•°å‘¼ã³å‡ºã—ã‚’ãƒ­ã‚°å‡ºåŠ›
def log_function_call(func):
    @functools.wraps(func)
    def wrapper(*args, **kwargs):
        func_name = func.__name__
        args_repr = [repr(a) for a in args]
        kwargs_repr = [f"{k}={v!r}" for k, v in kwargs.items()]
        signature = ", ".join(args_repr + kwargs_repr)
        logger.info(f"â†’ å‘¼ã³å‡ºã—: {func_name}({signature})")
        result = func(*args, **kwargs)
        logger.info(f"â† å®Œäº†: {func_name}() â†’ {result!r}")
        return result
    return wrapper


# ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼2: å®Ÿè¡Œæ™‚é–“ã‚’è¨ˆæ¸¬
def measure_execution_time(func):
    @functools.wraps(func)
    def wrapper(*args, **kwargs):
        func_name = func.__name__
        start_time = time.time()
        result = func(*args, **kwargs)
        end_time = time.time()
        elapsed_ms = (end_time - start_time) * 1000
        logger.info(f"â± {func_name}() ã®å®Ÿè¡Œæ™‚é–“: {elapsed_ms:.2f}ms")
        return result
    return wrapper


# ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼3: ã‚¨ãƒ©ãƒ¼ã‚’ã‚­ãƒ£ãƒƒãƒ
def handle_errors(func):
    @functools.wraps(func)
    def wrapper(*args, **kwargs):
        func_name = func.__name__
        try:
            return func(*args, **kwargs)
        except Exception as e:
            logger.error(f"âŒ {func_name}() ã§ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ: {type(e).__name__}: {e}")
            import traceback
            logger.error(f"ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹:\n{traceback.format_exc()}")
            raise
    return wrapper


# ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼4: ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½
def retry(max_attempts=3, delay_seconds=1.0):
    def decorator(func):
        @functools.wraps(func)
        def wrapper(*args, **kwargs):
            func_name = func.__name__
            for attempt in range(1, max_attempts + 1):
                try:
                    logger.info(f"ğŸ”„ {func_name}() è©¦è¡Œ {attempt}/{max_attempts}")
                    result = func(*args, **kwargs)
                    if attempt > 1:
                        logger.info(f"âœ… {func_name}() æˆåŠŸï¼ˆ{attempt}å›ç›®ï¼‰")
                    return result
                except Exception as e:
                    if attempt < max_attempts:
                        logger.warning(f"âš ï¸ {func_name}() å¤±æ•—ï¼ˆ{attempt}/{max_attempts}ï¼‰: {e}")
                        logger.info(f"â³ {delay_seconds}ç§’å¾…æ©Ÿå¾Œã«å†è©¦è¡Œ...")
                        time.sleep(delay_seconds)
                    else:
                        logger.error(f"âŒ {func_name}() å…¨è©¦è¡Œå¤±æ•—")
                        raise
        return wrapper
    return decorator


# ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼5: å…¨éƒ¨ç››ã‚Š
def apply_all_logging(func):
    func = handle_errors(func)
    func = measure_execution_time(func)
    func = log_function_call(func)
    return func
```

---

## ğŸ“ ã‚¹ãƒ†ãƒƒãƒ—3: main.py ã‚’ä½œæˆ

**æ‰‹é †**:
1. ãƒ¡ãƒ¢å¸³ã¾ãŸã¯VSCodeã‚’é–‹ã
2. ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼
3. `main.py` ã¨ã—ã¦ä¿å­˜ï¼ˆdecorators.py ã¨åŒã˜ãƒ•ã‚©ãƒ«ãƒ€ï¼‰

```python
"""main.py - ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’ä½¿ã†ãƒ•ã‚¡ã‚¤ãƒ«"""

# é‡è¦ï¼ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
from decorators import (
    log_function_call,
    measure_execution_time,
    handle_errors,
    retry,
    apply_all_logging
)

import time


# ä¾‹1: åŸºæœ¬çš„ãªä½¿ã„æ–¹
@log_function_call
def add_numbers(a, b):
    """2ã¤ã®æ•°ã‚’è¶³ã™"""
    return a + b


# ä¾‹2: å®Ÿè¡Œæ™‚é–“ã‚’è¨ˆæ¸¬
@measure_execution_time
def slow_function():
    """æ™‚é–“ã®ã‹ã‹ã‚‹å‡¦ç†"""
    time.sleep(0.5)
    return "å®Œäº†"


# ä¾‹3: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
@handle_errors
def divide(a, b):
    """å‰²ã‚Šç®—"""
    return a / b


# ä¾‹4: è¤‡æ•°ã®ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’çµ„ã¿åˆã‚ã›
@handle_errors
@measure_execution_time
@log_function_call
def fetch_data(user_id):
    """ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆè¤‡æ•°ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ï¼‰"""
    print(f"ãƒ¦ãƒ¼ã‚¶ãƒ¼{user_id}ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ä¸­...")
    time.sleep(0.2)
    return {"id": user_id, "name": "ç”°ä¸­å¤ªéƒ"}


# ä¾‹5: ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½
attempt_count = 0

@retry(max_attempts=3, delay_seconds=0.5)
def unstable_api():
    """ä¸å®‰å®šãªAPIï¼ˆãƒªãƒˆãƒ©ã‚¤ä»˜ãï¼‰"""
    global attempt_count
    attempt_count += 1
    
    # 2å›ç›®ã§æˆåŠŸã™ã‚‹ã‚ˆã†ã«ã™ã‚‹
    if attempt_count < 2:
        raise ConnectionError("æ¥ç¶šå¤±æ•—")
    
    return {"status": "success"}


# ä¾‹6: å…¨éƒ¨ç››ã‚Š
@apply_all_logging
def process_payment(amount):
    """æ”¯æ‰•ã„å‡¦ç†ï¼ˆå…¨ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼é©ç”¨ï¼‰"""
    print(f"{amount}å††ã®æ”¯æ‰•ã„ã‚’å‡¦ç†ä¸­...")
    time.sleep(0.1)
    
    if amount < 0:
        raise ValueError("é‡‘é¡ã¯æ­£ã®æ•°ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™")
    
    return {"status": "completed", "amount": amount}


# ãƒ¡ã‚¤ãƒ³å‡¦ç†
def main():
    """ãƒ¡ã‚¤ãƒ³é–¢æ•°"""
    print("=" * 70)
    print("ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ ãƒ‡ãƒ¢ãƒ—ãƒ­ã‚°ãƒ©ãƒ ")
    print("=" * 70)
    
    # ãƒ†ã‚¹ãƒˆ1
    print("\nã€ãƒ†ã‚¹ãƒˆ1: è¶³ã—ç®—ã€‘")
    result = add_numbers(3, 5)
    print(f"çµæœ: {result}\n")
    
    # ãƒ†ã‚¹ãƒˆ2
    print("\nã€ãƒ†ã‚¹ãƒˆ2: æ™‚é–“è¨ˆæ¸¬ã€‘")
    slow_function()
    print()
    
    # ãƒ†ã‚¹ãƒˆ3
    print("\nã€ãƒ†ã‚¹ãƒˆ3: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã€‘")
    try:
        divide(10, 2)  # æ­£å¸¸
        print()
        divide(10, 0)  # ã‚¨ãƒ©ãƒ¼
    except ZeroDivisionError:
        print("â†’ ã‚¨ãƒ©ãƒ¼ã‚’è£œè¶³ã—ã¾ã—ãŸ\n")
    
    # ãƒ†ã‚¹ãƒˆ4
    print("\nã€ãƒ†ã‚¹ãƒˆ4: è¤‡æ•°ã®ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ã€‘")
    data = fetch_data(123)
    print(f"å–å¾—ãƒ‡ãƒ¼ã‚¿: {data}\n")
    
    # ãƒ†ã‚¹ãƒˆ5
    print("\nã€ãƒ†ã‚¹ãƒˆ5: ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½ã€‘")
    global attempt_count
    attempt_count = 0
    api_result = unstable_api()
    print(f"APIçµæœ: {api_result}\n")
    
    # ãƒ†ã‚¹ãƒˆ6
    print("\nã€ãƒ†ã‚¹ãƒˆ6: å…¨éƒ¨ç››ã‚Šã€‘")
    payment = process_payment(1000)
    print(f"æ”¯æ‰•ã„çµæœ: {payment}\n")
    
    print("=" * 70)
    print("ãƒ‡ãƒ¢å®Œäº†ï¼")
    print("=" * 70)


if __name__ == "__main__":
    main()
```

---

## ğŸš€ ã‚¹ãƒ†ãƒƒãƒ—4: å®Ÿè¡Œ

### PowerShellã§å®Ÿè¡Œ

```powershell
# ãƒ•ã‚©ãƒ«ãƒ€ã«ç§»å‹•
cd C:\Users\yukik\Desktop\excel

# ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ã‹ç¢ºèª
ls

# å®Ÿè¡Œ
py main.py
```

### VSCodeã§å®Ÿè¡Œ

1. `main.py` ã‚’é–‹ã
2. **F5** ã‚­ãƒ¼ã‚’æŠ¼ã™
3. ã¾ãŸã¯ã€å³ã‚¯ãƒªãƒƒã‚¯ â†’ "Run Python File in Terminal"

---

## âœ… æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›

```
======================================================================
ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ ãƒ‡ãƒ¢ãƒ—ãƒ­ã‚°ãƒ©ãƒ 
======================================================================

ã€ãƒ†ã‚¹ãƒˆ1: è¶³ã—ç®—ã€‘
[10:30:15] INFO     â†’ å‘¼ã³å‡ºã—: add_numbers(3, 5)
[10:30:15] INFO     â† å®Œäº†: add_numbers() â†’ 8
çµæœ: 8

ã€ãƒ†ã‚¹ãƒˆ2: æ™‚é–“è¨ˆæ¸¬ã€‘
[10:30:15] INFO     â± slow_function() ã®å®Ÿè¡Œæ™‚é–“: 500.15ms

ã€ãƒ†ã‚¹ãƒˆ3: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã€‘
[10:30:16] ERROR    âŒ divide() ã§ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ: ZeroDivisionError: division by zero
â†’ ã‚¨ãƒ©ãƒ¼ã‚’è£œè¶³ã—ã¾ã—ãŸ

ã€ãƒ†ã‚¹ãƒˆ4: è¤‡æ•°ã®ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ã€‘
[10:30:16] INFO     â†’ å‘¼ã³å‡ºã—: fetch_data(123)
ãƒ¦ãƒ¼ã‚¶ãƒ¼123ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ä¸­...
[10:30:16] INFO     â± fetch_data() ã®å®Ÿè¡Œæ™‚é–“: 200.32ms
[10:30:16] INFO     â† å®Œäº†: fetch_data() â†’ {'id': 123, 'name': 'ç”°ä¸­å¤ªéƒ'}
å–å¾—ãƒ‡ãƒ¼ã‚¿: {'id': 123, 'name': 'ç”°ä¸­å¤ªéƒ'}

ã€ãƒ†ã‚¹ãƒˆ5: ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½ã€‘
[10:30:17] INFO     ğŸ”„ unstable_api() è©¦è¡Œ 1/3
[10:30:17] WARNING  âš ï¸ unstable_api() å¤±æ•—ï¼ˆ1/3ï¼‰: æ¥ç¶šå¤±æ•—
[10:30:17] INFO     â³ 0.5ç§’å¾…æ©Ÿå¾Œã«å†è©¦è¡Œ...
[10:30:18] INFO     ğŸ”„ unstable_api() è©¦è¡Œ 2/3
[10:30:18] INFO     âœ… unstable_api() æˆåŠŸï¼ˆ2å›ç›®ï¼‰
APIçµæœ: {'status': 'success'}

ã€ãƒ†ã‚¹ãƒˆ6: å…¨éƒ¨ç››ã‚Šã€‘
[10:30:18] INFO     â†’ å‘¼ã³å‡ºã—: process_payment(1000)
1000å††ã®æ”¯æ‰•ã„ã‚’å‡¦ç†ä¸­...
[10:30:18] INFO     â± process_payment() ã®å®Ÿè¡Œæ™‚é–“: 100.25ms
[10:30:18] INFO     â† å®Œäº†: process_payment() â†’ {'status': 'completed', 'amount': 1000}
æ”¯æ‰•ã„çµæœ: {'status': 'completed', 'amount': 1000}

======================================================================
ãƒ‡ãƒ¢å®Œäº†ï¼
======================================================================
```

---

## ğŸ› ï¸ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚¨ãƒ©ãƒ¼1: ModuleNotFoundError

```
ModuleNotFoundError: No module named 'decorators'
```

**åŸå› **: `decorators.py` ãŒåŒã˜ãƒ•ã‚©ãƒ«ãƒ€ã«ãªã„

**è§£æ±ºç­–**:
```powershell
# ç¾åœ¨ã®ãƒ•ã‚©ãƒ«ãƒ€ã‚’ç¢ºèª
pwd

# ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’ç¢ºèª
ls

# decorators.py ã¨ main.py ãŒä¸¡æ–¹ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
```

---

### ã‚¨ãƒ©ãƒ¼2: NameError

```
NameError: name 'log_function_call' is not defined
```

**åŸå› **: ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ–‡ãŒæ›¸ã‹ã‚Œã¦ã„ãªã„

**è§£æ±ºç­–**: `main.py` ã®å…ˆé ­ã«è¿½åŠ 
```python
from decorators import log_function_call
```

---

### ã‚¨ãƒ©ãƒ¼3: SyntaxError

```
SyntaxError: invalid syntax
```

**åŸå› **: ã‚³ãƒ”ãƒšæ™‚ã«ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆãŒå´©ã‚ŒãŸ

**è§£æ±ºç­–**: ã‚³ãƒ¼ãƒ‰ã‚’å†åº¦ã‚³ãƒ”ãƒ¼ã—ã¦ã€å…¨ã¦ç½®ãæ›ãˆã‚‹

---

## ğŸ“š è‡ªåˆ†ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ä½¿ã†æ–¹æ³•

### ãƒ‘ã‚¿ãƒ¼ãƒ³1: é–¢æ•°ã«é©ç”¨

```python
from decorators import log_function_call, handle_errors

@handle_errors
@log_function_call
def your_function(x, y):
    # ã‚ãªãŸã®ã‚³ãƒ¼ãƒ‰
    return x + y
```

### ãƒ‘ã‚¿ãƒ¼ãƒ³2: ã‚¯ãƒ©ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰ã«é©ç”¨

```python
from decorators import measure_execution_time

class MyService:
    @measure_execution_time
    def process(self, data):
        # å‡¦ç†
        return data
```

### ãƒ‘ã‚¿ãƒ¼ãƒ³3: APIå‘¼ã³å‡ºã—ã«é©ç”¨

```python
from decorators import retry, handle_errors

@retry(max_attempts=3, delay_seconds=2.0)
@handle_errors
def api_call(url):
    import requests
    response = requests.get(url)
    return response.json()
```

---

## ğŸ“ ã‚ˆãä½¿ã†çµ„ã¿åˆã‚ã›

### Web APIç”¨

```python
@retry(max_attempts=3)
@handle_errors
@measure_execution_time
@log_function_call
def call_external_api(endpoint):
    # APIå‘¼ã³å‡ºã—
    pass
```

### ãƒ‡ãƒ¼ã‚¿å‡¦ç†ç”¨

```python
@handle_errors
@measure_execution_time
@log_function_call
def process_large_data(data):
    # é‡ã„å‡¦ç†
    pass
```

### é‡è¦ãªæ¥­å‹™ãƒ­ã‚¸ãƒƒã‚¯ç”¨

```python
@apply_all_logging
def important_business_logic(params):
    # é‡è¦ãªå‡¦ç†
    pass
```

---

## ğŸ“‹ ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

å®Ÿè¡Œå‰ã«ç¢ºèª:

- [ ] `decorators.py` ã‚’ä½œæˆã—ãŸ
- [ ] `main.py` ã‚’ä½œæˆã—ãŸ
- [ ] ä¸¡æ–¹ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒåŒã˜ãƒ•ã‚©ãƒ«ãƒ€ã«ã‚ã‚‹
- [ ] `main.py` ã§ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ–‡ã‚’æ›¸ã„ãŸ
- [ ] ãƒ•ã‚¡ã‚¤ãƒ«åã«ç‰¹æ®Šæ–‡å­—ãŒãªã„

---

## ğŸ¯ ã¾ã¨ã‚

### ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ã®ä½œã‚Šæ–¹

```python
import functools

def my_decorator(func):
    @functools.wraps(func)  # å¿…é ˆï¼
    def wrapper(*args, **kwargs):
        # å‰å‡¦ç†
        result = func(*args, **kwargs)
        # å¾Œå‡¦ç†
        return result
    return wrapper
```

### ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ã®ä½¿ã„æ–¹

```python
# ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
from decorators import my_decorator

# é©ç”¨
@my_decorator
def my_function():
    pass
```

### é‡è¦ãƒã‚¤ãƒ³ãƒˆ

1. **functools.wraps(func) ã¯å¿…é ˆ**
2. **decorators.py ã¨ main.py ã¯åŒã˜ãƒ•ã‚©ãƒ«ãƒ€**
3. **å¿…ãšã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹**
4. **ä¸‹ã‹ã‚‰ä¸Šã«é©ç”¨ã•ã‚Œã‚‹**

---

"""
============================================================
ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ã¨ã¯ä½•ã‹ï¼Ÿ
============================================================

ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ã¯ã€Œé–¢æ•°ã‚’è£…é£¾ï¼ˆãƒ‡ã‚³ãƒ¬ãƒ¼ãƒˆï¼‰ã™ã‚‹é–¢æ•°ã€ã§ã™ã€‚
@ãƒãƒ¼ã‚¯ã‚’ä½¿ã£ã¦ã€æ—¢å­˜ã®é–¢æ•°ã«æ–°ã—ã„æ©Ÿèƒ½ã‚’è¿½åŠ ã§ãã¾ã™ã€‚
"""

# ===================================================================
# 1-1. ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ãªã—ã®ã‚³ãƒ¼ãƒ‰ï¼ˆBeforeï¼‰
# ===================================================================

def greet(name):
    """æŒ¨æ‹¶ã™ã‚‹é–¢æ•°"""
    print(f"ã“ã‚“ã«ã¡ã¯ã€{name}ã•ã‚“ï¼")

# é–¢æ•°ã‚’å‘¼ã¶
greet("ç”°ä¸­")
# å‡ºåŠ›: ã“ã‚“ã«ã¡ã¯ã€ç”°ä¸­ã•ã‚“ï¼


# ===================================================================
# 1-2. ãƒ­ã‚°ã‚’è¿½åŠ ã—ãŸã„å ´åˆï¼ˆãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ãªã—ï¼‰
# ===================================================================

def greet_with_log(name):
    """æŒ¨æ‹¶ã™ã‚‹é–¢æ•°ï¼ˆãƒ­ã‚°ä»˜ãï¼‰"""
    print("[LOG] greeté–¢æ•°ãŒå‘¼ã°ã‚Œã¾ã—ãŸ")  # â† ã“ã®è¡Œã‚’æ¯å›æ›¸ãå¿…è¦ãŒã‚ã‚‹
    print(f"ã“ã‚“ã«ã¡ã¯ã€{name}ã•ã‚“ï¼")
    print("[LOG] greeté–¢æ•°ãŒçµ‚äº†ã—ã¾ã—ãŸ")  # â† ã“ã®è¡Œã‚‚æ¯å›æ›¸ãå¿…è¦ãŒã‚ã‚‹

greet_with_log("ä½è—¤")
# å‡ºåŠ›:
# [LOG] greeté–¢æ•°ãŒå‘¼ã°ã‚Œã¾ã—ãŸ
# ã“ã‚“ã«ã¡ã¯ã€ä½è—¤ã•ã‚“ï¼
# [LOG] greeté–¢æ•°ãŒçµ‚äº†ã—ã¾ã—ãŸ


# ===================================================================
# 1-3. ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’ä½¿ã†å ´åˆï¼ˆAfterï¼‰
# ===================================================================

# ã¾ãšã€ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’å®šç¾©
def add_log(func):
    """ãƒ­ã‚°ã‚’è¿½åŠ ã™ã‚‹ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼"""
    def wrapper(*args, **kwargs):
        print(f"[LOG] {func.__name__}é–¢æ•°ãŒå‘¼ã°ã‚Œã¾ã—ãŸ")
        result = func(*args, **kwargs)  # å…ƒã®é–¢æ•°ã‚’å®Ÿè¡Œ
        print(f"[LOG] {func.__name__}é–¢æ•°ãŒçµ‚äº†ã—ã¾ã—ãŸ")
        return result
    return wrapper


# ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’ä½¿ã£ã¦é–¢æ•°ã‚’è£…é£¾
@add_log
def greet_decorated(name):
    """æŒ¨æ‹¶ã™ã‚‹é–¢æ•°ï¼ˆãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ä½¿ç”¨ï¼‰"""
    print(f"ã“ã‚“ã«ã¡ã¯ã€{name}ã•ã‚“ï¼")


# æ™®é€šã«é–¢æ•°ã‚’å‘¼ã¶ã ã‘ï¼
greet_decorated("éˆ´æœ¨")
# å‡ºåŠ›:
# [LOG] greet_decoratedé–¢æ•°ãŒå‘¼ã°ã‚Œã¾ã—ãŸ
# ã“ã‚“ã«ã¡ã¯ã€éˆ´æœ¨ã•ã‚“ï¼
# [LOG] greet_decoratedé–¢æ•°ãŒçµ‚äº†ã—ã¾ã—ãŸ


"""
============================================================
ãƒã‚¤ãƒ³ãƒˆ1: ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ã®ä»•çµ„ã¿
============================================================

@add_log
def greet_decorated(name):
    print(f"ã“ã‚“ã«ã¡ã¯ã€{name}ã•ã‚“ï¼")

â†“ ã“ã‚Œã¯ä»¥ä¸‹ã¨åŒã˜æ„å‘³

def greet_decorated(name):
    print(f"ã“ã‚“ã«ã¡ã¯ã€{name}ã•ã‚“ï¼")

greet_decorated = add_log(greet_decorated)

ã¤ã¾ã‚Šã€ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ã¯ã€Œé–¢æ•°ã‚’å—ã‘å–ã£ã¦ã€æ–°ã—ã„é–¢æ•°ã‚’è¿”ã™ã€é–¢æ•°ã§ã™ã€‚
"""


# ===================================================================
# 1-4. ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ã®æ§‹é€ ã‚’ç†è§£ã™ã‚‹
# ===================================================================

def my_decorator(func):
    """
    ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
    
    Args:
        func: ãƒ‡ã‚³ãƒ¬ãƒ¼ãƒˆã™ã‚‹é–¢æ•°
    
    Returns:
        wrapper: ãƒ©ãƒƒãƒ—ã•ã‚ŒãŸæ–°ã—ã„é–¢æ•°
    """
    # ã‚¹ãƒ†ãƒƒãƒ—1: wrapperé–¢æ•°ã‚’å®šç¾©
    def wrapper(*args, **kwargs):
        # ã‚¹ãƒ†ãƒƒãƒ—2: å…ƒã®é–¢æ•°ã®å‰ã«å®Ÿè¡Œã™ã‚‹å‡¦ç†
        print("--- é–¢æ•°å®Ÿè¡Œå‰ ---")
        
        # ã‚¹ãƒ†ãƒƒãƒ—3: å…ƒã®é–¢æ•°ã‚’å®Ÿè¡Œ
        result = func(*args, **kwargs)
        
        # ã‚¹ãƒ†ãƒƒãƒ—4: å…ƒã®é–¢æ•°ã®å¾Œã«å®Ÿè¡Œã™ã‚‹å‡¦ç†
        print("--- é–¢æ•°å®Ÿè¡Œå¾Œ ---")
        
        # ã‚¹ãƒ†ãƒƒãƒ—5: çµæœã‚’è¿”ã™
        return result
    
    # ã‚¹ãƒ†ãƒƒãƒ—6: wrapperé–¢æ•°ã‚’è¿”ã™
    return wrapper


# ä½¿ç”¨ä¾‹
@my_decorator
def say_hello():
    print("Hello!")

say_hello()
# å‡ºåŠ›:
# --- é–¢æ•°å®Ÿè¡Œå‰ ---
# Hello!
# --- é–¢æ•°å®Ÿè¡Œå¾Œ ---


"""
============================================================
ãƒã‚¤ãƒ³ãƒˆ2: *args ã¨ **kwargs
============================================================

*args:  ä½ç½®å¼•æ•°ã‚’å…¨ã¦å—ã‘å–ã‚‹
**kwargs: ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å¼•æ•°ã‚’å…¨ã¦å—ã‘å–ã‚‹

ã“ã‚Œã«ã‚ˆã‚Šã€ã©ã‚“ãªå¼•æ•°ã®é–¢æ•°ã«ã‚‚å¯¾å¿œã§ãã¾ã™ã€‚

ä¾‹:
    def wrapper(*args, **kwargs):
        func(*args, **kwargs)
    
    # ä»¥ä¸‹ã®å…¨ã¦ã«å¯¾å¿œå¯èƒ½
    func()              # å¼•æ•°ãªã—
    func(1, 2, 3)       # ä½ç½®å¼•æ•°
    func(a=1, b=2)      # ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å¼•æ•°
    func(1, 2, c=3)     # æ··åœ¨
"""


# ===================================================================
# 1-5. å®Ÿè·µä¾‹ï¼šæ™‚é–“è¨ˆæ¸¬ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼
# ===================================================================

import time

def measure_time(func):
    """å®Ÿè¡Œæ™‚é–“ã‚’è¨ˆæ¸¬ã™ã‚‹ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼"""
    def wrapper(*args, **kwargs):
        # é–‹å§‹æ™‚åˆ»ã‚’è¨˜éŒ²
        start_time = time.time()
        
        # å…ƒã®é–¢æ•°ã‚’å®Ÿè¡Œ
        result = func(*args, **kwargs)
        
        # çµ‚äº†æ™‚åˆ»ã‚’è¨˜éŒ²
        end_time = time.time()
        
        # å®Ÿè¡Œæ™‚é–“ã‚’è¨ˆç®—
        elapsed_time = end_time - start_time
        print(f"[TIME] {func.__name__}ã®å®Ÿè¡Œæ™‚é–“: {elapsed_time:.4f}ç§’")
        
        return result
    
    return wrapper


@measure_time
def slow_function():
    """æ™‚é–“ã®ã‹ã‹ã‚‹å‡¦ç†"""
    time.sleep(1)
    print("å‡¦ç†å®Œäº†")

slow_function()
# å‡ºåŠ›:
# å‡¦ç†å®Œäº†
# [TIME] slow_functionã®å®Ÿè¡Œæ™‚é–“: 1.0012ç§’


"""
============================================================
ã‚¹ãƒ†ãƒƒãƒ—1ã®ã¾ã¨ã‚
============================================================

âœ… ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ã¯ã€Œé–¢æ•°ã‚’å—ã‘å–ã£ã¦ã€æ–°ã—ã„é–¢æ•°ã‚’è¿”ã™ã€é–¢æ•°
âœ… @ãƒãƒ¼ã‚¯ã§ç°¡æ½”ã«æ›¸ã‘ã‚‹
âœ… *args, **kwargs ã§ã©ã‚“ãªé–¢æ•°ã«ã‚‚å¯¾å¿œ
âœ… å…ƒã®é–¢æ•°ã®å‰å¾Œã«å‡¦ç†ã‚’è¿½åŠ ã§ãã‚‹

æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—: functools.wraps ã‚’ä½¿ã£ã¦å®Œç’§ãªãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’ä½œã‚‹
"""

ã“ã‚Œã§å®Ÿå‹™ãƒ¬ãƒ™ãƒ«ã®ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ãŒä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸï¼ğŸ‰âœ¨
